<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wei.boot.mapper.DemandOrderMapper">
  <resultMap id="BaseResultMap" type="com.wei.boot.model.DemandOrder">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="demand_id" jdbcType="INTEGER" property="demandId" />
    <result column="order_number" jdbcType="VARCHAR" property="orderNumber" />
    <result column="worker_count" jdbcType="INTEGER" property="workerCount" />
    <result column="operator_user" jdbcType="INTEGER" property="operatorUser" />
    <result column="customer" jdbcType="VARCHAR" property="customer" />
    <result column="total_income" jdbcType="VARCHAR" property="totalIncome" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="create_user" jdbcType="INTEGER" property="createUser" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="update_user" jdbcType="INTEGER" property="updateUser" />
    <result column="company_name" jdbcType="VARCHAR" property="companyName" />
    <result column="create_user_name" jdbcType="VARCHAR" property="createUserName" />
    <result column="confirm_state" jdbcType="INTEGER" property="confirmState" />
    <result column="confirm_user" jdbcType="INTEGER" property="confirmUser" />
    <result column="confirm_time" jdbcType="TIMESTAMP" property="confirmTime" />
    <result column="reject_reason" jdbcType="VARCHAR" property="rejectReason" />
    <result column="confirm_state_name" jdbcType="VARCHAR" property="confirmStateName" />
    <result column="confirm_user_name" jdbcType="VARCHAR" property="confirmUserName" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    id, demand_id, order_number, worker_count, operator_user, customer, total_income, 
    description, create_user, create_time, update_time, update_user, confirm_state, confirm_user,
    confirm_time, reject_reason
  </sql>
  <select id="selectByExample" parameterType="com.wei.boot.model.DemandOrderExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from t_yx_demand_order
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_yx_demand_order
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    delete from t_yx_demand_order
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.wei.boot.model.DemandOrderExample">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    delete from t_yx_demand_order
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.wei.boot.model.DemandOrder">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    insert into t_yx_demand_order (id, demand_id, order_number, 
      worker_count, operator_user, customer, 
      total_income, description, create_user, 
      create_time, update_time, update_user,
      confirm_state, confirm_user, confirm_time, reject_reason
      )
    values (#{id,jdbcType=INTEGER}, #{demandId,jdbcType=INTEGER}, #{orderNumber,jdbcType=VARCHAR}, 
      #{workerCount,jdbcType=INTEGER}, #{operatorUser,jdbcType=INTEGER}, #{customer,jdbcType=VARCHAR}, 
      #{totalIncome,jdbcType=VARCHAR}, #{description,jdbcType=VARCHAR}, #{createUser,jdbcType=INTEGER}, 
      #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=INTEGER},
      #{confirmState,jdbcType=INTEGER},#{confirmUser,jdbcType=INTEGER},#{confirmTime,jdbcType=TIMESTAMP},
      #{rejectReason,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.wei.boot.model.DemandOrder">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
	      select LAST_INSERT_ID()
	</selectKey>
    insert into t_yx_demand_order
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="demandId != null">
        demand_id,
      </if>
      <if test="orderNumber != null">
        order_number,
      </if>
      <if test="workerCount != null">
        worker_count,
      </if>
      <if test="operatorUser != null">
        operator_user,
      </if>
      <if test="customer != null">
        customer,
      </if>
      <if test="totalIncome != null">
        total_income,
      </if>
      <if test="description != null">
        description,
      </if>
      <if test="createUser != null">
        create_user,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="updateUser != null">
        update_user,
      </if>
      <if test="confirmState != null">
        confirm_state,
      </if>
      <if test="confirmUser != null">
        confirm_user,
      </if>
      <if test="confirmTime != null">
        confirm_time,
      </if>
      <if test="rejectReason != null">
        reject_reason,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="demandId != null">
        #{demandId,jdbcType=INTEGER},
      </if>
      <if test="orderNumber != null">
        #{orderNumber,jdbcType=VARCHAR},
      </if>
      <if test="workerCount != null">
        #{workerCount,jdbcType=INTEGER},
      </if>
      <if test="operatorUser != null">
        #{operatorUser,jdbcType=INTEGER},
      </if>
      <if test="customer != null">
        #{customer,jdbcType=VARCHAR},
      </if>
      <if test="totalIncome != null">
        #{totalIncome,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="confirmState != null">
        #{confirmState,jdbcType=INTEGER},
      </if>
      <if test="confirmUser != null">
        #{confirmUser,jdbcType=INTEGER},
      </if>
      <if test="confirmTime != null">
        #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="rejectReason != null">
        #{rejectReason,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.wei.boot.model.DemandOrderExample" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    select count(*) from t_yx_demand_order
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    update t_yx_demand_order
    <set>
      <if test="record.id != null">
        id = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.demandId != null">
        demand_id = #{record.demandId,jdbcType=INTEGER},
      </if>
      <if test="record.orderNumber != null">
        order_number = #{record.orderNumber,jdbcType=VARCHAR},
      </if>
      <if test="record.workerCount != null">
        worker_count = #{record.workerCount,jdbcType=INTEGER},
      </if>
      <if test="record.operatorUser != null">
        operator_user = #{record.operatorUser,jdbcType=INTEGER},
      </if>
      <if test="record.customer != null">
        customer = #{record.customer,jdbcType=VARCHAR},
      </if>
      <if test="record.totalIncome != null">
        total_income = #{record.totalIncome,jdbcType=VARCHAR},
      </if>
      <if test="record.description != null">
        description = #{record.description,jdbcType=VARCHAR},
      </if>
      <if test="record.createUser != null">
        create_user = #{record.createUser,jdbcType=INTEGER},
      </if>
      <if test="record.createTime != null">
        create_time = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateTime != null">
        update_time = #{record.updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateUser != null">
        update_user = #{record.updateUser,jdbcType=INTEGER},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    update t_yx_demand_order
    set id = #{record.id,jdbcType=INTEGER},
      demand_id = #{record.demandId,jdbcType=INTEGER},
      order_number = #{record.orderNumber,jdbcType=VARCHAR},
      worker_count = #{record.workerCount,jdbcType=INTEGER},
      operator_user = #{record.operatorUser,jdbcType=INTEGER},
      customer = #{record.customer,jdbcType=VARCHAR},
      total_income = #{record.totalIncome,jdbcType=VARCHAR},
      description = #{record.description,jdbcType=VARCHAR},
      create_user = #{record.createUser,jdbcType=INTEGER},
      create_time = #{record.createTime,jdbcType=TIMESTAMP},
      update_time = #{record.updateTime,jdbcType=TIMESTAMP},
      update_user = #{record.updateUser,jdbcType=INTEGER}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.wei.boot.model.DemandOrder">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    update t_yx_demand_order
    <set>
      <if test="demandId != null">
        demand_id = #{demandId,jdbcType=INTEGER},
      </if>
      <if test="orderNumber != null">
        order_number = #{orderNumber,jdbcType=VARCHAR},
      </if>
      <if test="workerCount != null">
        worker_count = #{workerCount,jdbcType=INTEGER},
      </if>
      <if test="operatorUser != null">
        operator_user = #{operatorUser,jdbcType=INTEGER},
      </if>
      <if test="customer != null">
        customer = #{customer,jdbcType=VARCHAR},
      </if>
      <if test="totalIncome != null">
        total_income = #{totalIncome,jdbcType=VARCHAR},
      </if>
      <if test="description != null">
        description = #{description,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        create_user = #{createUser,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        update_user = #{updateUser,jdbcType=INTEGER},
      </if>
      <if test="confirmState != null">
        confirm_state = #{confirmState,jdbcType=INTEGER},
      </if>
      <if test="confirmUser != null">
        confirm_user = #{confirmUser,jdbcType=INTEGER},
      </if>
      <if test="confirmTime != null">
        confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="rejectReason != null">
        reject_reason = #{rejectReason,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.wei.boot.model.DemandOrder">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 21 16:49:38 CST 2018.
    -->
    update t_yx_demand_order
    set demand_id = #{demandId,jdbcType=INTEGER},
      order_number = #{orderNumber,jdbcType=VARCHAR},
      worker_count = #{workerCount,jdbcType=INTEGER},
      operator_user = #{operatorUser,jdbcType=INTEGER},
      customer = #{customer,jdbcType=VARCHAR},
      total_income = #{totalIncome,jdbcType=VARCHAR},
      description = #{description,jdbcType=VARCHAR},
      create_user = #{createUser,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      update_user = #{updateUser,jdbcType=INTEGER},
      confirm_state = #{confirmState,jdbcType=INTEGER},
      confirm_user = #{confirmUser,jdbcType=INTEGER},
      confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      reject_reason = #{rejectReason,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <update id="confirmOrder" parameterType="map">
    update t_yx_demand_order
    <set>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="confirmState != null">
        confirm_state = #{confirmState,jdbcType=INTEGER},
      </if>
      <if test="confirmUser != null">
        confirm_user = #{confirmUser,jdbcType=INTEGER},
      </if>
      <if test="confirmTime != null">
        confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
      </if>
      <if test="rejectReason != null">
        reject_reason = #{rejectReason,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{orderId,jdbcType=INTEGER}
  </update>
  
  <select id="selectAllOrderCount" resultType="int">
  	select count(1) from t_yx_demand_order
  </select>
  <select id="selectOrderCountByTime" parameterType="map" resultType="int">
  	select count(1) from t_yx_demand_order t 
  	<where>
  		<if test="beginTime != null">
			and t.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and t.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
  	</where>
  </select>
  
  <select id="selectAllOrderWorkerCount" resultType="int">
  	select sum(worker_count) from t_yx_demand_order
  </select>
  <select id="selectOrderWorkerCountByTime" parameterType="map" resultType="int">
  	select sum(worker_count) from t_yx_demand_order t 
  	<where>
  		<if test="beginTime != null">
			and t.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and t.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
  	</where>
  </select>
  
  <select id="selectAllIncome" resultType="bigdecimal">
  	select sum(cast(t.total_income as  decimal(10,2))) from t_yx_demand_order t
  </select>
  <select id="selectIncomeByTime" parameterType="map" resultType="bigdecimal">
  	select sum(cast(t.total_income as  decimal(10,2))) from t_yx_demand_order t
  	<where>
  		<if test="beginTime != null">
			and t.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and t.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
  	</where>
  </select>
  
  <select id="selectIncomeByDemandId" parameterType="int" resultType="bigdecimal">
  	select sum(cast(t.total_income as  decimal(10,2))) from t_yx_demand_order t
  	<where>
	  t.demand_id = #{demandId,jdbcType=INTEGER}
	</where>
  </select>
  
  <select id="selectSigningCountByDemandId" parameterType="int" resultType="int">
  	select sum(t.worker_count) from t_yx_demand_order t
  	<where>
	  t.demand_id = #{demandId,jdbcType=INTEGER}
	</where>
  </select>
  
  
  <select id="selectByPage" parameterType="map" resultMap="BaseResultMap">
  	SELECT
		o.id, o.demand_id, o.order_number, o.worker_count, o.operator_user, o.customer, o.total_income, 
    	o.description, o.create_user, o.create_time,
		u.real_name create_user_name, o.confirm_state, o.confirm_user, o.confirm_time, o.reject_reason,
		c.NAME company_name, 
		(case when o.confirm_state = 0 then '待确认' when o.confirm_state = 1 then '被驳回' when o.confirm_state = 2 then '已确认' end) confirm_state_name
	FROM
		t_yx_demand_order o,
		t_yx_demand d,
		t_yx_company c,
		t_sys_user u
	WHERE
		o.demand_id = d.id 
		AND d.company_id = c.id
		and d.undertake_user = u.id
		and o.id &lt;= (
			select o1.id from t_yx_demand_order o1,t_yx_demand d1,t_yx_company c1,t_sys_user u1
			where o1.demand_id = d1.id AND d1.company_id = c1.id and d1.undertake_user = u1.id 
			<if test="beginTime != null">
				and o1.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
			</if>
			<if test="endTime != null">
				and o1.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
			</if>
			<if test="companyName != null">
				and c1.name like #{companyName,jdbcType=VARCHAR}
			</if>
			<if test="orderNumber != null">
				and o1.order_number = #{orderNumber,jdbcType=VARCHAR}
			</if>
			<if test="createUserName != null">
				and u1.real_name like #{createUserName,jdbcType=VARCHAR}
			</if>
			<if test="confirmState != null">
				and o1.confirm_state = #{confirmState,jdbcType=INTEGER}
			</if>
			order by o1.id desc limit #{offset,jdbcType=INTEGER},1
		 )
	<if test="beginTime != null">
		and o.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
	</if>
	<if test="endTime != null">
		and o.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
	</if>
	<if test="companyName != null">
		and c.name like #{companyName,jdbcType=VARCHAR}
	</if>
	<if test="orderNumber != null">
		and o.order_number = #{orderNumber,jdbcType=VARCHAR}
	</if>
	<if test="createUserName != null">
		and u.real_name like #{createUserName,jdbcType=VARCHAR}
	</if>
	<if test="confirmState != null">
		and o.confirm_state = #{confirmState,jdbcType=INTEGER}
	</if>	
  	order by o.id desc limit #{pageSize,jdbcType=INTEGER}
  </select>
  
  <select id="selectCount" parameterType="map" resultType="int">
  	SELECT count(1)
	FROM
		t_yx_demand_order o,
		t_yx_demand d,
		t_yx_company c,
		t_sys_user u 
	WHERE
		o.demand_id = d.id 
		AND d.company_id = c.id
		and d.undertake_user = u.id
	<if test="beginTime != null">
		and o.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
	</if>
	<if test="endTime != null">
		and o.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
	</if>
	<if test="companyName != null">
		and c.name like #{companyName,jdbcType=VARCHAR}
	</if>
	<if test="orderNumber != null">
		and o.order_number = #{orderNumber,jdbcType=VARCHAR}
	</if>
	<if test="createUserName != null">
		and u.real_name like #{createUserName,jdbcType=VARCHAR}
	</if>	
	<if test="confirmState != null">
		and o.confirm_state = #{confirmState,jdbcType=INTEGER}
	</if>
  </select>
  
  <select id="selectOrderCount" resultType="map">
  	select '新增订单' name,
	(select count(0) from t_yx_demand_order t where DATEDIFF(t.create_time, curdate()) = 0) day,
	(select count(0) from t_yx_demand_order t where t.create_time &gt;= date_sub(curdate(),interval WEEKDAY(curdate()) day)) week,
	(select count(0) from t_yx_demand_order t where t.create_time &gt;= date_sub(curdate(),interval DAY(curdate())-1 day)) month,
	(select count(0) from t_yx_demand_order t where t.create_time &gt;= date(concat(year(curdate()),'-',elt(quarter(curdate()),1,4,7,10),'-',1))) season,
	(select count(0) from t_yx_demand_order t where t.create_time &gt;= DATE_SUB(CURDATE(),INTERVAL dayofyear(now())-1 DAY)) year
  </select>
  
  <select id="selectIncomeCount" resultType="map">
  	select '新增营收' name,
	(select ifnull(sum(cast(t.total_income as  decimal(10,2))),0) from t_yx_demand_order t where DATEDIFF(t.create_time, curdate()) = 0) day,
	(select ifnull(sum(cast(t.total_income as  decimal(10,2))),0) from t_yx_demand_order t where t.create_time &gt;= date_sub(curdate(),interval WEEKDAY(curdate()) day)) week,
	(select ifnull(sum(cast(t.total_income as  decimal(10,2))),0) from t_yx_demand_order t where t.create_time &gt;= date_sub(curdate(),interval DAY(curdate())-1 day)) month,
	(select ifnull(sum(cast(t.total_income as  decimal(10,2))),0) from t_yx_demand_order t where t.create_time &gt;= date(concat(year(curdate()),'-',elt(quarter(curdate()),1,4,7,10),'-',1))) season,
	(select ifnull(sum(cast(t.total_income as  decimal(10,2))),0) from t_yx_demand_order t where t.create_time &gt;= DATE_SUB(CURDATE(),INTERVAL dayofyear(now())-1 DAY)) year
  </select>
  
  <select id="selectOrderWorkerCount" resultType="map">
  	select '新增签订人数' name,
	(select ifnull(sum(worker_count),0) from t_yx_demand_order t where DATEDIFF(t.create_time, curdate()) = 0) day,
	(select ifnull(sum(worker_count),0) from t_yx_demand_order t where t.create_time &gt;= date_sub(curdate(),interval WEEKDAY(curdate()) day)) week,
	(select ifnull(sum(worker_count),0) from t_yx_demand_order t where t.create_time &gt;= date_sub(curdate(),interval DAY(curdate())-1 day)) month,
	(select ifnull(sum(worker_count),0) from t_yx_demand_order t where t.create_time &gt;= date(concat(year(curdate()),'-',elt(quarter(curdate()),1,4,7,10),'-',1))) season,
	(select ifnull(sum(worker_count),0) from t_yx_demand_order t where t.create_time &gt;= DATE_SUB(CURDATE(),INTERVAL dayofyear(now())-1 DAY)) year
  </select>
  <select id="selectCompanyOrderReport" parameterType="map" resultType="com.wei.boot.model.report.CompanyReportInfo">
  	SELECT
		c.NAME companyName,
		count( 0 ) orderCount,
		sum( o.worker_count ) orderMemberCount,
		sum( cast( o.total_income AS DECIMAL ( 10, 2 ) ) ) orderIncome 
	FROM
		t_yx_demand d,
		t_yx_demand_order o,
		t_yx_company c 
	WHERE
		d.id = o.demand_id 
		AND d.company_id = c.id 
		<if test="beginTime != null">
			and o.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and o.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		<if test="companyName != null">
			and c.name like #{companyName,jdbcType=VARCHAR}
		</if>
	GROUP BY c.NAME limit #{offset,jdbcType=INTEGER}, #{pageSize,jdbcType=INTEGER}
  </select>
  
  <select id="selectCompanyOrderReportCount" parameterType="map" resultType="int">
  	select count(1) from (
  	SELECT c.name FROM
		t_yx_demand d,
		t_yx_demand_order o,
		t_yx_company c 
	WHERE
		d.id = o.demand_id 
		AND d.company_id = c.id 
		<if test="beginTime != null">
			and o.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and o.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		<if test="companyName != null">
			and c.name like #{companyName,jdbcType=VARCHAR}
		</if>
	GROUP BY c.NAME) t
  </select>
  
  <select id="selectUserOrderReport" parameterType="map" resultType="com.wei.boot.model.report.CompanyReportInfo">
  	SELECT
		u.real_name userName,
		ifnull( x.worker_count, 0 ) workerCount,
		ifnull( y.demand_count, 0 ) demandCount,
		ifnull( z.orderCount, 0 ) orderCount,
		ifnull( orderMemberCount, 0 ) orderMemberCount,
		ifnull( orderIncome, 0 ) orderIncome, 
		ifnull( m.undertakeIncome, 0) undertakeIncome,
		ifnull( n.collectIncome, 0) collectIncome
	FROM
		t_sys_user u
		LEFT JOIN ( SELECT count( 0 ) worker_count, create_user FROM t_yx_worker where 1=1
		<if test="beginTime != null">
			and create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		 GROUP BY create_user ) x ON u.id = x.create_user
		LEFT JOIN ( SELECT count( 1 ) demand_count, d.undertake_user FROM t_yx_demand d where 1=1
		<if test="beginTime != null">
			and d.undertake_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and d.undertake_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		 GROUP BY d.undertake_user ) y ON u.id = y.undertake_user
		LEFT JOIN (
			SELECT
				count( 1 ) orderCount,
				sum( o1.worker_count ) orderMemberCount,
				sum( cast( o1.total_income AS DECIMAL ( 10, 2 ) ) ) orderIncome,
				d1.undertake_user 
			FROM
				t_yx_demand d1,
				t_yx_demand_order o1
			WHERE
				d1.id = o1.demand_id and o1.confirm_state = 2 
				<if test="beginTime != null">
					and o1.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
				</if>
				<if test="endTime != null">
					and o1.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
				</if>
				 group by d1.undertake_user
				) z ON u.id = z.undertake_user
		LEFT JOIN (select w.create_user, sum( cast( w.undertake_user_income AS DECIMAL ( 10, 2 ) ) ) undertakeIncome from t_yx_order_worker w,
		t_yx_demand_order do 
		where w.order_id = do.id and do.confirm_state = 2 
		<if test="beginTime != null">
			and w.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and w.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		
		 group by w.create_user) m
		on u.id = m.create_user
		left join (select w.create_user,sum( cast( ow.collect_user_income AS DECIMAL ( 10, 2 ) ) ) collectIncome from 
		t_yx_order_worker ow, t_yx_worker w, t_yx_demand_order do
		where ow.worker_id = w.id and ow.order_id = do.id and do.confirm_state = 2  
		<if test="beginTime != null">
			and ow.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and ow.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		 group by w.create_user) n
		on u.id = n.create_user
		where 1=1
		<if test="userName != null">
			and u.real_name like #{userName,jdbcType=VARCHAR}
		</if>
		
  </select>
  
  <select id="selectByDemandId" parameterType="int" resultMap="BaseResultMap">
  	select u.real_name create_user_name,(case when t.confirm_state = 0 then '待确认' when t.confirm_state = 1 then '被驳回' when t.confirm_state = 2 then '已确认' end) confirm_state_name,
  	t.* from t_yx_demand_order t,t_sys_user u where t.create_user = u.id
  	and t.demand_id = #{demandId,jdbcType=INTEGER}
  </select>
  
  <select id="selectTotalOrderCount" parameterType="map" resultType="com.wei.boot.model.report.CompanyReportInfo">
  	SELECT
		( SELECT count( 1 ) demand_count FROM t_yx_demand where 1=1
		<if test="beginTime != null">
			and create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
		 ) demandCount,
		count( 1 ) orderCount,
		sum( o.worker_count ) orderMemberCount,
		ifnull(sum( cast( o.total_income AS DECIMAL ( 10, 2 ) ) ),0) orderIncome 
	FROM
		t_yx_demand d,
		t_yx_demand_order o 
	WHERE
		d.id = o.demand_id
		<if test="beginTime != null">
			and o.create_time &gt;= #{beginTime,jdbcType=TIMESTAMP}
		</if>
		<if test="endTime != null">
			and o.create_time &lt;= #{endTime,jdbcType=TIMESTAMP}
		</if>
  </select>
</mapper>